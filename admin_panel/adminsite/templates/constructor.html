{% extends "base_adminsite.html" %}
{% block title %}AdminSite Конструктор меню{% endblock %}
{% block head_extra %}
    <link rel="stylesheet" href="{{ url_for('static', path='adminsite/constructor.css') }}">
{% endblock %}
{% block content %}
<div id="constructor-status-bar"></div>
<div class="page-actions" style="justify-content: space-between; align-items:flex-start; gap:16px;">
    <div>
        <h1>Меню витрины</h1>
        <p class="muted">Управляйте категориями, позициями и настройками сайта. Всё работает через единый API меню.</p>
    </div>
    <div class="notice" style="max-width: 360px;">
        <div class="badge-list">
            <span class="tag">Категории</span>
            <span class="tag">Позиции</span>
            <span class="tag">Настройки</span>
        </div>
        <p style="margin-top:10px;">Изменения публикуются сразу после сохранения.</p>
    </div>
</div>

<div id="global-status" class="status"></div>

<section class="panel" id="panel-menu">
    <div class="card">
        <div class="table-top">
            <div>
                <h3 style="margin:0;">Категории и позиции</h3>
                <p class="muted">Добавляйте категории, управляйте сортировкой и активностью. Позиции отображаются сразу на витрине и в боте.</p>
            </div>
            <div class="actions">
                <button class="btn-secondary" type="button" id="menu-refresh">Обновить</button>
            </div>
        </div>
        <div class="status" id="status-menu"></div>
        <div class="grid" style="grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap:16px;">
            <div class="card" style="margin:0;">
                <div class="card-header" style="align-items:center;">
                    <h4 style="margin:0;">Категории</h4>
                    <button class="btn-primary" type="button" id="category-add">+ Категория</button>
                </div>
                <div id="category-form" class="card" style="margin:0 0 12px; display:none;"></div>
                <div id="category-list" class="block-list"></div>
            </div>
            <div class="card" style="margin:0;">
                <div class="card-header" style="align-items:center;">
                    <div>
                        <h4 style="margin:0;">Позиции</h4>
                        <p class="muted" style="margin:4px 0 0;" id="items-caption">Выберите категорию слева.</p>
                    </div>
                    <button class="btn-primary" type="button" id="item-add">+ Позиция</button>
                </div>
                <div id="item-form" class="card" style="margin:0 0 12px; display:none;"></div>
                <div id="item-list" class="block-list"></div>
            </div>
        </div>
    </div>
</section>

<section class="panel" id="panel-settings">
    <div class="card">
        <div class="table-top">
            <div>
                <h3 style="margin:0;">Настройки сайта</h3>
                <p class="muted">Бренд, цвета, контакты и hero блок для витрины.</p>
            </div>
            <div class="actions">
                <button class="btn-primary" type="button" id="settings-save">Сохранить</button>
            </div>
        </div>
        <div class="status" id="status-settings"></div>
        <div class="grid" style="grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap:12px;">
            <label class="field">
                <span>Бренд</span>
                <input type="text" id="settings-brand" placeholder="Название бренда" />
            </label>
            <label class="field">
                <span>Логотип (URL)</span>
                <input type="text" id="settings-logo" placeholder="/media/adminsite/..." />
            </label>
            <label class="field">
                <span>Primary color</span>
                <input type="text" id="settings-primary" placeholder="#7a8c70" />
            </label>
            <label class="field">
                <span>Secondary color</span>
                <input type="text" id="settings-secondary" placeholder="#334155" />
            </label>
            <label class="field">
                <span>Background</span>
                <input type="text" id="settings-background" placeholder="linear-gradient(...) или #fff" />
            </label>
            <label class="field">
                <span>Hero заголовок</span>
                <input type="text" id="settings-hero-title" />
            </label>
            <label class="field">
                <span>Hero подзаголовок</span>
                <textarea id="settings-hero-subtitle" rows="3"></textarea>
            </label>
            <label class="field">
                <span>Hero изображение (URL)</span>
                <input type="text" id="settings-hero-image" />
            </label>
            <label class="field">
                <span>Контакты (JSON)</span>
                <textarea id="settings-contacts" rows="4" placeholder='{"phone": "+7...", "email": "hello@"}'></textarea>
            </label>
            <label class="field">
                <span>Соцсети (JSON)</span>
                <textarea id="settings-social" rows="4" placeholder='{"instagram": "https://..."}'></textarea>
            </label>
        </div>
    </div>
</section>

<section class="panel" id="panel-media">
    <div class="card">
        <div class="table-top">
            <div>
                <h3 style="margin:0;">Медиа-библиотека</h3>
                <p class="muted">Загружайте изображения и копируйте URL. Файлы сохраняются в /media/adminsite/.</p>
            </div>
            <div class="badge-list">
                <span class="tag">upload</span>
                <span class="tag">preview</span>
                <span class="tag">copy URL</span>
            </div>
        </div>
        <div class="status" id="status-media"></div>
        <div class="media-grid">
            <div class="card upload-card">
                <h4 style="margin-top:0;">Загрузка файла</h4>
                <p class="muted" style="margin-top:-4px;">jpg, png или webp до 5 МБ</p>
                <label class="file-input">Выберите файл
                    <input type="file" id="media-upload-input" accept="image/jpeg,image/png,image/webp" />
                </label>
                <div class="actions" style="margin-top:12px;">
                    <button class="btn-primary" type="button" id="media-upload-btn">Загрузить</button>
                    <button class="btn-ghost" type="button" id="media-refresh">Обновить</button>
                </div>
                <div class="status" id="media-upload-status"></div>
            </div>
            <div class="card list-card">
                <div class="card-header" style="gap:12px;">
                    <h4 style="margin:0;">Файлы</h4>
                    <input type="search" id="media-search" placeholder="Поиск по имени" />
                </div>
                <div id="media-list" class="media-list"></div>
            </div>
        </div>
    </div>
</section>
{% endblock %}
{% block scripts %}
    <script type="module" src="{{ url_for('static', path='adminsite/constructor.js') }}"></script>
{% endblock %}
