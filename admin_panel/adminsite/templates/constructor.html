{% extends "base_adminsite.html" %}
{% block title %}AdminSite Конструктор{% endblock %}
{% block head_extra %}
    <link rel="stylesheet" href="{{ url_for('static', path='adminsite/constructor.css') }}">
{% endblock %}
{% block content %}
<div id="constructor-status-bar"></div>
<div class="page-actions" style="justify-content: space-between; align-items:flex-start; gap:16px;">
    <div>
        <h1>Категории, элементы и WebApp кнопка</h1>
        <p class="muted">Управляйте категориями и элементами витрины. Используйте вкладку «WebApp кнопка», чтобы настроить действие красной кнопки.</p>
    </div>
    <div class="notice" style="max-width: 360px;">
        <div class="badge-list">
            <span class="tag">Категории</span>
            <span class="tag">Товары</span>
            <span class="tag">Мастер-классы</span>
            <span class="tag">WebApp</span>
        </div>
        <p style="margin-top:10px;">Все изменения сохраняются через API AdminSite без перезагрузки страницы.</p>
    </div>
</div>

<div id="global-status" class="status"></div>

<div class="tabs" id="constructor-tabs"></div>

<div id="constructor-panels"></div>

<section class="panel" id="panel-webapp">
    <div class="card">
        <div class="table-top">
            <div>
                <h3 style="margin:0;">WebApp кнопка</h3>
                <p class="muted">Настройка действия красной кнопки WebApp.</p>
            </div>
            <div class="badge-list">
                <span class="tag">action_label</span>
                <span class="tag">scope</span>
                <span class="tag">type</span>
            </div>
        </div>
        <div class="status" id="status-webapp"></div>
        <div class="grid" style="grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap:14px;">
            <div class="card" style="padding:14px;">
                <form id="webapp-form">
                    <label>Текст кнопки
                        <input type="text" name="action_label" id="webapp-label" placeholder="Например, Открыть витрину" required />
                    </label>
                    <label>Scope
                        <select name="scope" id="webapp-scope">
                            <option value="global">global</option>
                            <option value="category">category</option>
                        </select>
                    </label>
                    <div class="form-row">
                        <label>Type
                            <select name="type" id="webapp-type">
                                <option value="product">product — витрина товаров</option>
                                <option value="course">course — витрина мастер-классов</option>
                            </select>
                        </label>
                        <label id="webapp-category-wrapper">Category
                            <select name="category_id" id="webapp-category"></select>
                        </label>
                    </div>
                    <div class="form-row">
                        <div>
                            <label>Минимум выбранных
                                <input type="number" name="min_selected" id="webapp-min-selected" min="0" value="1" />
                            </label>
                        </div>
                        <div style="display:flex; align-items:center; gap:8px; margin-top:26px;">
                            <input type="checkbox" id="webapp-enabled" />
                            <label for="webapp-enabled" class="muted">action_enabled</label>
                        </div>
                    </div>
                    <div class="actions" style="margin-top:18px; gap:8px;">
                        <button class="btn-secondary" id="webapp-reload" type="button">Обновить</button>
                        <button class="btn-primary" type="submit">Сохранить</button>
                    </div>
                </form>
            </div>
            <div class="card" style="padding:14px;">
                <h4 style="margin-top:0;">Подсказки</h4>
                <p class="muted">Тип действия и категория влияют на то, что откроется по кнопке. Если категория не указана, используется корневая страница витрины.</p>
                <div class="divider"></div>
                <p class="muted">Флаг <b>action_enabled</b> отключает кнопку без удаления настроек.</p>
            </div>
        </div>
    </div>
</section>

<section class="panel" id="panel-homepage">
    <div class="card">
        <div class="table-top">
            <div>
                <h3 style="margin:0;">Главная страница</h3>
                <p class="muted">Шаблоны оформления и блоки для витрины AdminSite. Контент остаётся неизменным при смене шаблона.</p>
            </div>
            <div class="badge-list">
                <span class="tag">HeroBlock</span>
                <span class="tag">CardsBlock</span>
                <span class="tag">TextBlock</span>
                <span class="tag">SocialBlock</span>
            </div>
        </div>
        <div class="status" id="status-homepage"></div>
        <div class="grid" style="grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap:14px;">
            <div class="card" style="padding:14px;">
                <h4 style="margin-top:0;">Шаблон</h4>
                <label>Выберите пресет оформления
                    <select id="homepage-template">
                        <option value="baskets">Baskets</option>
                        <option value="electronics">Electronics</option>
                        <option value="services">Services (дефолт)</option>
                    </select>
                </label>
                <p class="muted" style="margin-top:6px;">Смена шаблона влияет только на цвета, радиусы и тени. Контент блоков не меняется.</p>
                <div class="divider"></div>
                <p class="muted">Шаблоны описаны в registry и применяются на фронте через CSS variables.</p>
            </div>
            <div class="card" style="padding:14px;">
                <h4 style="margin-top:0;">Блоки</h4>
                <p class="muted" style="margin-top:-4px;">Редактируйте конфигурацию блоков в формате JSON. Поддерживаются hero, cards, text, social.</p>
                <textarea id="homepage-blocks" rows="18" style="width:100%; resize:vertical; font-family: monospace;"></textarea>
                <div class="actions" style="margin-top:12px; gap:8px;">
                    <button class="btn-secondary" type="button" id="homepage-reset">Сбросить</button>
                    <button class="btn-primary" type="button" id="homepage-save">Сохранить</button>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}
{% block scripts %}
    <script type="module" src="{{ url_for('static', path='adminsite/constructor.js') }}"></script>
{% endblock %}
