<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>История пользователя {{ target_user_id }}</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 16px; background: #f5f5f5; }
        header { display: flex; gap: 12px; margin-bottom: 16px; }
        .card { background:#fff; border:1px solid #d1d5db; border-radius:8px; padding:16px; }
        .event { border-bottom:1px solid #e5e7eb; padding:10px 0; }
        .event:last-child { border-bottom:none; }
        .event-type { padding:2px 6px; border-radius:4px; font-size:12px; background:#e0f2fe; color:#0369a1; }
        .event-type.error { background:#fee2e2; color:#b91c1c; }
        .muted { color:#475569; font-size:14px; }
        pre { margin: 6px 0 0 0; white-space: pre-wrap; word-break: break-word; }
    </style>
</head>
<body>
<header>
    <a href="/adminbot" class="button" style="padding:6px 10px; background:#2563eb; color:#fff; text-decoration:none; border-radius:4px;">Главная</a>
    <a href="/adminbot/templates" class="button" style="padding:6px 10px; background:#2563eb; color:#fff; text-decoration:none; border-radius:4px;">Шаблоны</a>
    <a href="/adminbot/logs" class="button" style="padding:6px 10px; background:#0ea5e9; color:#fff; text-decoration:none; border-radius:4px;">Логи</a>
    <a href="/adminbot/automations" class="button" style="padding:6px 10px; background:#2563eb; color:#fff; text-decoration:none; border-radius:4px;">Автоматизации</a>
    <a href="/adminbot/logout" class="button" style="padding:6px 10px; background:#dc2626; color:#fff; text-decoration:none; border-radius:4px;">Выйти</a>
</header>
<h2>История пользователя {{ target_user_id }}</h2>
<div class="muted">Показана последовательность событий (макс. 500 последних записей).</div>
<div class="card" style="margin-top:12px;">
    {% for log in logs %}
        <div class="event">
            <div class="muted">{{ log.created_at }}</div>
            <div style="display:flex; gap:8px; align-items:center;">
                <span class="event-type {% if log.event_type == 'ERROR' %}error{% endif %}">{{ log.event_type }}</span>
                <strong>{{ log.node_code or '—' }}</strong>
                <span class="muted">config v{{ log.config_version }}</span>
            </div>
            {% if log.details %}<pre>{{ log.details }}</pre>{% endif %}
        </div>
    {% else %}
        <p class="muted">История пуста.</p>
    {% endfor %}
</div>
</body>
</html>
