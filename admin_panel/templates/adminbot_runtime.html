<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Работа бота</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 16px; background: #f5f5f5; }
        header { display: flex; gap: 12px; margin-bottom: 16px; }
        .card { background: #fff; padding: 16px; border: 1px solid #cbd5e1; border-radius: 6px; max-width: 600px; }
        .button { padding: 8px 12px; border: none; background: #2563eb; color: #fff; border-radius: 4px; text-decoration: none; cursor: pointer; }
        .muted { color: #475569; font-size: 14px; }
        .log-box { background: #0f172a; color: #e2e8f0; padding: 12px; border-radius: 6px; max-height: 260px; overflow: auto; white-space: pre-wrap; font-family: "SFMono-Regular", Consolas, "Liberation Mono", monospace; font-size: 13px; }
    </style>
</head>
<body>
<header>
    <a href="/adminbot" class="button">Главная</a>
    <a href="/adminbot/templates" class="button">Шаблоны</a>
    <a href="/adminbot/nodes" class="button">Узлы</a>
    <a href="/adminbot/triggers" class="button">Триггеры</a>
    <a href="/adminbot/media" class="button">Медиа</a>
    <a href="/adminbot/runtime" class="button" style="background:#0ea5e9;">Работа бота</a>
    <a href="/adminbot/logs" class="button">Логи</a>
    <a href="/adminbot/logout" class="button" style="background:#dc2626;">Выйти</a>
</header>
<div class="card">
    <h2>Работа бота</h2>
    <p>Текущая версия сценария: <strong>{{ runtime.config_version }}</strong></p>
    <p class="muted">При изменении версии бот обновит кэш меню. Перезапуск не требуется.</p>
    <form method="post" action="/adminbot/runtime">
        <input type="hidden" name="action" value="bump">
        <button type="submit" class="button" title="Нажмите, если изменили узлы или триггеры, чтобы бот подхватил обновления">Обновить бота</button>
    </form>
    <p class="muted" style="margin-top:10px;">Если бот ведёт себя как раньше, увеличьте номер версии и нажмите «Обновить бота».</p>
</div>

<div class="card" style="margin-top:16px;">
    <h2>Стартовый узел (/start)</h2>
    <p class="muted">Укажите код узла, который должен открываться по команде /start. Например: <code>MAIN_MENU</code> или <code>SUBSCRIPTION_CHECK</code>.</p>
    <form method="post" action="/adminbot/runtime" style="margin-top:12px; display:flex; gap:8px; align-items:flex-end;">
        <input type="hidden" name="action" value="update_start">
        <div style="flex:1;">
            <label for="start_node_code" style="display:block; font-weight:bold;">Код стартового узла</label>
            <input type="text" id="start_node_code" name="start_node_code" value="{{ runtime.start_node_code or 'MAIN_MENU' }}" placeholder="Например: SUBSCRIPTION_CHECK" style="width:100%; padding:8px; border:1px solid #cbd5e1; border-radius:4px;">
            <div class="muted" style="margin-top:6px;">Чтобы включить проверку подписки, создайте узел-условие <strong>SUBSCRIPTION_CHECK</strong> и укажите его здесь.</div>
        </div>
        <button type="submit" class="button" style="height:42px;">Сохранить</button>
    </form>
</div>
</body>
</html>
