<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Логи сервисов</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; background:#0b1220; color:#e2e8f0; }
        header { background:#38bdf8; color:#0b1220; padding:16px; display:flex; gap:12px; align-items:center; }
        header a { color:#0b1220; text-decoration:none; font-weight:bold; padding:8px 12px; border-radius:10px; background:#e0f2fe; }
        header a.active { background:#0b1220; color:#38bdf8; }
        main { padding:20px; }
        .card { background:#0f172a; border:1px solid #1e293b; border-radius:12px; padding:16px; }
        .tabs { display:flex; gap:10px; margin-bottom:12px; }
        .tabs a { padding:8px 12px; border-radius:10px; text-decoration:none; border:1px solid #38bdf8; color:#e2e8f0; }
        .tabs a.active { background:#38bdf8; color:#0b1220; }
        form { display:flex; gap:12px; align-items:center; margin-bottom:14px; }
        input[type=number] { width:100px; padding:6px; border-radius:8px; border:1px solid #334155; background:#0b1220; color:#e2e8f0; }
        button { padding:8px 12px; border:none; border-radius:8px; background:#38bdf8; color:#0b1220; font-weight:bold; cursor:pointer; }
        pre { background:#0b1220; border:1px solid #1e293b; border-radius:12px; padding:12px; white-space:pre-wrap; word-break:break-word; max-height:70vh; overflow:auto; font-family: "SFMono-Regular", Consolas, monospace; }
        .muted { color:#94a3b8; font-size:14px; }
        .empty { padding:12px; border:1px dashed #334155; border-radius:10px; background:#0b1220; color:#94a3b8; }
    </style>
</head>
<body>
<header>
    <a href="/adminbot">Главная</a>
    <a href="/adminbot/templates">Шаблоны</a>
    <a href="/adminbot/nodes">Узлы</a>
    <a href="/adminbot/triggers">Триггеры</a>
    <a href="/adminbot/runtime">Работа бота</a>
    <a href="/adminbot/logs" class="active">Логи</a>
    <a href="/adminbot/logs/history">История событий</a>
    <a href="/adminbot/logout" style="margin-left:auto; background:#0b1220; color:#38bdf8;">Выйти</a>
</header>
<main>
    <div class="card">
        <div class="tabs">
            <a href="/adminbot/logs?source=api&limit={{ limit }}" class="{% if selected_source == 'api' %}active{% endif %}">Логи API</a>
            <a href="/adminbot/logs?source=bot&limit={{ limit }}" class="{% if selected_source == 'bot' %}active{% endif %}">Логи бота</a>
        </div>
        <p class="muted">Логи показывают свежие записи из файлов сервисов. Используйте их, если бот ведёт себя необычно.</p>
        <form method="get" action="/adminbot/logs">
            <input type="hidden" name="source" value="{{ selected_source }}" />
            <label>Строк:<br><input type="number" min="1" max="2000" name="limit" value="{{ limit }}" /></label>
            <label>Уровень:<br>
                <select name="level">
                    <option value="" {% if not selected_level %}selected{% endif %}>Все</option>
                    <option value="INFO" {% if selected_level == 'INFO' %}selected{% endif %}>INFO</option>
                    <option value="WARN" {% if selected_level == 'WARN' %}selected{% endif %}>WARN</option>
                    <option value="ERROR" {% if selected_level == 'ERROR' %}selected{% endif %}>ERROR</option>
                </select>
            </label>
            <button type="submit">Обновить</button>
            <span class="muted">Файлы: {{ sources['api'] }} и {{ sources['bot'] }}. Фильтр по уровню пока визуальный.</span>
        </form>

        {% if not_found %}
            <div class="empty">Файл лога не найден. Логи ещё не настроены или сервис не писал лог. Подключите запись логов в utils.logging_config.</div>
        {% elif not lines %}
            <div class="empty">Файл найден, но пока пустой.</div>
        {% else %}
            <pre>{% for line in lines %}{{ line }}
{% endfor %}</pre>
        {% endif %}
    </div>
</main>
</body>
</html>
