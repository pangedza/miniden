<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>–ö–æ—Ä–∑–∏–Ω–∞ Handmade Baskets</title>
  <link rel="stylesheet" href="style.css" />
  <script defer src="script.js"></script>
</head>
<body>
  <header class="topbar">
    <div class="logo">üß∫ Handmade Baskets</div>
    <nav class="menu">
      <a href="index.html">–ì–ª–∞–≤–Ω–∞—è</a>
      <a href="catalog.html">–ö–∞—Ç–∞–ª–æ–≥</a>
      <a href="orders.html">–ó–∞–∫–∞–∑—ã</a>
      <a href="auth.html">–í–æ–π—Ç–∏</a>
      <a href="cart.html" class="active">–ö–æ—Ä–∑–∏–Ω–∞</a>
    </nav>
  </header>

  <main class="cart">
    <h1>–í–∞—à–∞ –∫–æ—Ä–∑–∏–Ω–∞</h1>
    <p class="cart-subtitle">–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã –ø–µ—Ä–µ–¥ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ–º –∑–∞–∫–∞–∑–∞.</p>

    <div class="table-wrapper">
      <table id="cart-table">
        <thead>
          <tr>
            <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
            <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
            <th>–¶–µ–Ω–∞</th>
            <th></th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <div class="total" aria-live="polite">
      <p>–ò—Ç–æ–≥–æ: <span id="total-price">0</span> ‚ÇΩ</p>
      <button id="checkout" class="btn" disabled>–ü–µ—Ä–µ–π—Ç–∏ –∫ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—é</button>
    </div>
    <p id="checkout-msg" class="note"></p>
  </main>

  <footer>
    <p>¬© 2025 Handmade Baskets</p>
  </footer>

  <!-- auto-injected: checkout handler -->
  <script type="module">
    import { createOrder, me } from './js/api.js';
    const btn = document.getElementById('checkout');
    const note = document.getElementById('checkout-msg');
    btn?.addEventListener('click', async ()=>{
      try {
        await me();
        const stored = localStorage.getItem('cart');
        const cart = JSON.parse(stored || '[]')
          .map(i => ({ name: i.name, price: Number(i.price), qty: Number(i.qty ?? i.quantity ?? 1) }))
          .filter(i => i.name && i.price>0 && i.qty>0);
        if (!cart.length) { note.textContent = '–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞'; return; }
        const res = await createOrder(cart);
        note.textContent = `–ó–∞–∫–∞–∑ #${res.order_id} –æ—Ñ–æ—Ä–º–ª–µ–Ω!`;
        localStorage.removeItem('cart');
        setTimeout(()=>location.href='orders.html', 800);
      } catch(e) {
        if (String(e.message).includes('unauthorized')) location.href='auth.html';
        else note.textContent = '–û—à–∏–±–∫–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è: '+e.message;
      }
    });
  </script>
  <!-- /auto-injected -->
</body>
</html>
