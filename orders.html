<!doctype html><html lang="ru"><head>
  <meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Мои заказы</title>
  <link rel="stylesheet" href="style.css">
  <script type="module">
    import { myOrders, me } from './js/api.js';
    async function load(){
      try { await me(); } catch { location.href='auth.html'; return; }
      const box = document.getElementById('orders');
      try{
        const data = await myOrders();
        if (!data.orders?.length){ box.innerHTML = 'Пока нет заказов.'; return; }
        box.innerHTML = data.orders.map(o => {
          const items = typeof o.items === 'string' ? JSON.parse(o.items) : o.items;
          const list = (items || []).map(i=>`<li>${i.name} × ${i.qty} — ${i.price} ₽</li>`).join('');
          return `
            <div class="card" style="margin:1rem 0;padding:1rem">
              <h3>Заказ #${o.id} • ${new Date(o.created_at).toLocaleString('ru-RU')}</h3>
              <ul>${list}</ul>
              <p><b>Итого:</b> ${o.total} ₽ • <i>${o.status}</i></p>
            </div>
          `;
        }).join('');
      }catch(e){ box.textContent = 'Ошибка загрузки: '+e.message; }
    }
    load();
  </script>
</head><body>
  <header class="topbar"><nav class="menu">
    <a href="index.html">Главная</a>
    <a href="catalog.html">Каталог</a>
    <a href="auth.html">Войти</a>
    <a href="cart.html">Корзина</a>
  </nav></header>
  <main class="catalog">
    <h2>Мои заказы</h2>
    <div id="orders"></div>
  </main>
</body></html>
