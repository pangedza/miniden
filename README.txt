===============================

–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
-----------------

- –û—Å–Ω–æ–≤–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö: PostgreSQL (—á–µ—Ä–µ–∑ SQLAlchemy –∏–∑ `database.py`).
- –ö–∞—Ç–∞–ª–æ–≥ –∫–æ—Ä–∑–∏–Ω–æ–∫ –∏ –∫—É—Ä—Å–æ–≤, –∫–æ—Ä–∑–∏–Ω–∞, –∑–∞–∫–∞–∑—ã, –∏–∑–±—Ä–∞–Ω–Ω–æ–µ –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü–∞—Ö PostgreSQL.
- –í—Å—è –≤–∏—Ç—Ä–∏–Ω–∞ –º–∞–≥–∞–∑–∏–Ω–∞, –∫–æ—Ä–∑–∏–Ω–∞, –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤ –∏ –ø—Ä–æ—Ñ–∏–ª—å —Ä–∞–±–æ—Ç–∞—é—Ç —á–µ—Ä–µ–∑ WebApp, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –æ–±—â–∏–π backend `webapi.py` –∏ —Ç—É –∂–µ PostgreSQL-–ë–î.
- –ë–æ—Ç —Å–ª—É–∂–∏—Ç —Ç–æ—á–∫–æ–π –≤—Ö–æ–¥–∞: /start, –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–π –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ –∫–∞–Ω–∞–ª –∏ –ø–æ–∫–∞–∑ –≥–ª–∞–≤–Ω–æ–≥–æ –º–µ–Ω—é —Å WebApp-–∫–Ω–æ–ø–∫–∞–º–∏.

–ù–∞—Å–ª–µ–¥–∏–µ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏
--------------------------

–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏ –±–æ—Ç –ø–æ–¥–Ω–∏–º–∞–ª—Å—è –±–µ–∑ –≤–Ω–µ—à–Ω–µ–π –ë–î: –∫–∞—Ç–∞–ª–æ–≥ –ø–æ–¥–≥—Ä—É–∂–∞–ª—Å—è –∏–∑ `data/products_baskets.json` –∏
`data/products_courses.json`, –∞ –∫–æ—Ä–∑–∏–Ω–∞ —Å–æ–±–∏—Ä–∞–ª–∞—Å—å –≤ –ø–∞–º—è—Ç–∏. –≠—Ç–∏ —Ñ–∞–π–ª—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ –∏
–º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –Ω–∞–ø–æ–ª–Ω–µ–Ω–∏—è –∫–∞—Ç–∞–ª–æ–≥–∞, –Ω–æ –æ—Å–Ω–æ–≤–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ —Ç–µ–ø–µ—Ä—å ‚Äî PostgreSQL.

---

## –ü–µ—Ä–µ–Ω–æ—Å –º–∞–≥–∞–∑–∏–Ω–∞ –∏–∑ –±–æ—Ç–∞ –≤ WebApp

–ù–∞—á–∏–Ω–∞—è —Å –≤–µ—Ä—Å–∏–∏ X:

- –ö–∞—Ç–∞–ª–æ–≥ –∫–æ—Ä–∑–∏–Ω–æ–∫ –∏ –∫—É—Ä—Å–æ–≤ –±–æ–ª—å—à–µ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ Telegram-–±–æ—Ç–∞.
- –ö–æ—Ä–∑–∏–Ω–∞ –∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞ –±–æ–ª—å—à–µ –Ω–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è —á–µ—Ä–µ–∑ —Å–æ–æ–±—â–µ–Ω–∏—è –±–æ—Ç–∞.
- –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –º–∞–≥–∞–∑–∏–Ω–∞ (–∫–∞—Ç–∞–ª–æ–≥, –∫–æ—Ä–∑–∏–Ω–∞, –∑–∞–∫–∞–∑, –ø—Ä–æ—Ñ–∏–ª—å) –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è
  –≤ WebApp, –∫–æ—Ç–æ—Ä—ã–π —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ —Ç–æ–π –∂–µ PostgreSQL-–ë–î (DATABASE_URL), —á—Ç–æ –∏ –±–æ—Ç.

–ë–æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞:

- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏ (REQUIRED_CHANNEL_ID / REQUIRED_CHANNEL_LINK).
- –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π —ç–∫—Ä–∞–Ω —á–µ—Ä–µ–∑ /start.
- –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é —Ç–æ–ª—å–∫–æ —Å WebApp-–∫–Ω–æ–ø–∫–∞–º–∏, –æ—Ç–∫—Ä—ã–≤–∞—é—â–∏–º–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å–∞–π—Ç–∞.
- (–í—Ä–µ–º–µ–Ω–Ω–æ) –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –∞–¥–º–∏–Ω—Å–∫–∏–µ –¥–µ–π—Å—Ç–≤–∏—è, –ø–æ–∫–∞ –æ–Ω–∏ –Ω–µ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã –≤ –≤–µ–±-–∞–¥–º–∏–Ω–∫—É.

## –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

**2025-11-27**

- –ü–æ–¥–∫–ª—é—á–µ–Ω–∞ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö PostgreSQL (`miniden` –Ω–∞ –ø–æ—Ä—Ç—É 5432 —á–µ—Ä–µ–∑ SQLAlchemy).
- –ö–∞—Ç–∞–ª–æ–≥ –∫–æ—Ä–∑–∏–Ω–æ–∫ –∏ –∫—É—Ä—Å–æ–≤, –∫–æ—Ä–∑–∏–Ω–∞, –∑–∞–∫–∞–∑—ã, –∏–∑–±—Ä–∞–Ω–Ω–æ–µ –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
  —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü–∞—Ö PostgreSQL (`products_baskets`, `products_courses`,
  `cart_items`, `orders`, `favorites`, `users` –∏ –¥—Ä.).
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ –≤ –∞–¥–º–∏–Ω–∫–µ: –∫–Ω–æ–ø–∫–∞ ¬´üìã –¢–æ–≤–∞—Ä—ã: –∫–æ—Ä–∑–∏–Ω–∫–∏/–∫—É—Ä—Å—ã¬ª —Ç–µ–ø–µ—Ä—å
  –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `services.products.list_products_admin(...)` –∏ –Ω–µ –ø–∞–¥–∞–µ—Ç
  —Å `TypeError: list_products_by_status() got an unexpected keyword argument 'product_type'`.
- –ë–æ—Ç –∏ WebApp –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–±—â—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö, –ø–æ–∫–∞ JSON-—Ñ–∞–π–ª—ã —Å–ª—É–∂–∞—Ç
  —Ç–æ–ª—å–∫–æ –¥–ª—è –Ω–∞—á–∞–ª—å–Ω–æ–≥–æ –Ω–∞–ø–æ–ª–Ω–µ–Ω–∏—è –∫–∞—Ç–∞–ª–æ–≥–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ).

## WebApp, –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∏ –∞–¥–º–∏–Ω–∫–∞

  - Backend –ø–æ–¥–Ω–∏–º–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ FastAPI-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ `webapi:app` –Ω–∞ 127.0.0.1:8000,
  nginx –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç `/api` –Ω–∞ —ç—Ç–æ—Ç –ø–æ—Ä—Ç.
  - –í—Å–µ –±–∏–∑–Ω–µ—Å-–¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ PostgreSQL (—Å—Ç—Ä–æ–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è `DATABASE_URL` –∏–∑ `.env`),
  —Ç–∞–±–ª–∏—Ü—ã –æ–±—â–∏–µ –¥–ª—è Telegram-–±–æ—Ç–∞ –∏ `webapi.py`.
  - –ö–∞—Ç–∞–ª–æ–≥ `api/routers/` —Å–æ–¥–µ—Ä–∂–∏—Ç legacy-–≤–µ—Ä—Å–∏—é API –¥–æ –ø–æ—è–≤–ª–µ–Ω–∏—è `webapi.py` –∏ –æ—Å—Ç–∞–≤–ª–µ–Ω –∫–∞–∫ –∞—Ä—Ö–∏–≤;
  –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ `webapi:app`.
  - Telegram WebApp-—Å—Ç—Ä–∞–Ω–∏—Ü—ã (`products.html`, `masterclasses.html`, `cart.html`,
  `profile.html`, `admin.html`) –∞–≤—Ç–æ—Ä–∏–∑—É—é—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ —ç–Ω–¥–ø–æ–∏–Ω—Ç:

    POST /api/auth/telegram

  —Å –ø–µ—Ä–µ–¥–∞—á–µ–π `initData` –∏–∑ `Telegram.WebApp`. Backend –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–¥–ø–∏—Å—å initData
  –ø–æ —Ç–æ–∫–µ–Ω—É –±–æ—Ç–∞ (BOT_TOKEN), —Å–æ–∑–¥–∞—ë—Ç/–æ–±–Ω–æ–≤–ª—è–µ—Ç –∑–∞–ø–∏—Å—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ PostgreSQL
  –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `telegram_id`, `username`, `full_name`, `is_admin`.

  - –ê–¥–º–∏–Ω—Å–∫–∏–µ –ø—Ä–∞–≤–∞ –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è `ADMIN_CHAT_ID` / `ADMIN_CHAT_IDS`.
  –ü—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –±–∞–∑—ã (`init_db`) –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å —Ç–∞–∫–∏–º–∏ ID –ø–æ–º–µ—á–∞—é—Ç—Å—è `is_admin = True`.

  - –í WebApp —Å—Å—ã–ª–∫–∞ ¬´–ê–¥–º–∏–Ω–∫–∞¬ª –≤ –≤–µ—Ä—Ö–Ω–µ–º –º–µ–Ω—é –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π,
  —É –∫–æ—Ç–æ—Ä—ã—Ö `is_admin = True`. –î–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –æ–Ω–∞ —Å–∫—Ä—ã—Ç–∞, –∞ –ø—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∫ admin.html
  –≤—Å—ë —Ä–∞–≤–Ω–æ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è backend'–æ–º (—ç–Ω–¥–ø–æ–∏–Ω—Ç—ã `/api/admin/*` –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç 403).

### –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –Ω–∞ —Å–∞–π—Ç–µ —á–µ—Ä–µ–∑ Telegram

- –î–ª—è –≤—Ö–æ–¥–∞ –Ω–∞ —Å–∞–π—Ç —Å –ü–ö –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Telegram Login Widget.
- –í @BotFather –Ω—É–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å `/setdomain` –∏ —É–∫–∞–∑–∞—Ç—å –¥–æ–º–µ–Ω `miniden.ru`.
- –ù–∞ —Å—Ç—Ä–∞–Ω–∏—á–∫–µ `index.html` –≤—Å—Ç—Ä–æ–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ ¬´–í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Telegram¬ª, –∫–æ—Ç–æ—Ä–∞—è –æ–±—Ä–∞—â–∞–µ—Ç—Å—è –∫
  `/api/auth/telegram-login`. –ë—ç–∫–µ–Ω–¥ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–¥–ø–∏—Å—å –¥–∞–Ω–Ω—ã—Ö, —Å–æ–∑–¥–∞—ë/–æ–±–Ω–æ–≤–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  –≤ –ë–î (—Ç–∞–±–ª–∏—Ü–∞ users) –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç cookie `tg_user_id` —Å –µ–≥–æ Telegram ID.
- –í—Å–µ –ø–æ—Å–ª–µ–¥—É—é—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã WebApp –∏—Å–ø–æ–ª—å–∑—É—é—Ç `/api/auth/session` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
  –æ —Ç–µ–∫—É—â–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ –ø–æ —ç—Ç–æ–π cookie.

### –¢–æ—á–∫–∏ –≤—Ö–æ–¥–∞ –Ω–∞ —Å–∞–π—Ç–µ

- **–ì–ª–∞–≤–Ω–∞—è (`index.html`)** ‚Äî —Å–æ–¥–µ—Ä–∂–∏—Ç –±–ª–æ–∫ ¬´–í—Ö–æ–¥ —á–µ—Ä–µ–∑ Telegram¬ª —Å –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–º Telegram Login Widget.
  –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—Ö–æ–¥–∞ backend —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç cookie –∏ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –≤ –ø—Ä–æ—Ñ–∏–ª—å.

- **–ö–æ—Ä–∑–∏–Ω–∞ (`cart.html`)** –∏ **–ü—Ä–æ—Ñ–∏–ª—å (`profile.html`)**:
  –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω, —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –ø–æ–Ω—è—Ç–Ω—ã–π –±–ª–æ–∫
  ¬´–í—ã –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã¬ª —Å –∫–Ω–æ–ø–∫–æ–π ¬´–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ –≥–ª–∞–≤–Ω—É—é –¥–ª—è –≤—Ö–æ–¥–∞¬ª.

- –í —Ä–µ–∂–∏–º–µ Telegram WebApp –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∏–¥—ë—Ç —á–µ—Ä–µ–∑ `initData` –∏ `/api/auth/telegram`.
  –í —Ä–µ–∂–∏–º–µ –æ–±—ã—á–Ω–æ–≥–æ –±—Ä–∞—É–∑–µ—Ä–∞ ‚Äî —á–µ—Ä–µ–∑ Telegram Login Widget –∏ `/api/auth/telegram-login` + `/api/auth/session`.

## –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç WebApp

- –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π –∫–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤ –∏ –º–∞—Å—Ç–µ—Ä-–∫–ª–∞—Å—Å–æ–≤ —á–µ—Ä–µ–∑ /api/categories –∏ /api/products.
- –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç) —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ /api/me –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∑–∞–∫–∞–∑—ã, –∏–∑–±—Ä–∞–Ω–Ω–æ–µ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É.
- –ê–¥–º–∏–Ω–∫–∞ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–∞ –≤ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (/webapp/admin.html) –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç /api/admin/*.
- –¢–æ–≤–∞—Ä—ã —Ä–∞–∑–¥–µ–ª–µ–Ω—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º (–∫–æ—Ä–∑–∏–Ω–∫–∏, –ª—é–ª—å–∫–∏ –∏ —Ç.–ø.), –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø–æ–¥–≥—Ä—É–∂–∞—é—Ç—Å—è –∏–∑ API.

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ WebApp (auth)

- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã `/api/auth/telegram` –∏ `/api/me`: —Ç–µ–ø–µ—Ä—å –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç JSON —Å –¥–∞–Ω–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è,
  –∞ –Ω–µ `null`. –ë–ª–∞–≥–æ–¥–∞—Ä—è —ç—Ç–æ–º—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ç–æ–≤–∞—Ä–æ–≤, –ø—Ä–æ—Ñ–∏–ª—è –∏ –∞–¥–º–∏–Ω–∫–∏ –±–æ–ª—å—à–µ –Ω–µ –ø–∞–¥–∞—é—Ç.
- –í `products.html`, `profile.html` –∏ `admin.html` –æ–±–Ω–æ–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `authorize()`:
  –ø—Ä–∏ –æ—à–∏–±–∫–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ WebApp –Ω–µ –ª–æ–º–∞–µ—Ç—Å—è, –∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ–Ω—è—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ.
